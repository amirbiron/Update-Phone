# פיצול אוטומטי של הודעות - תיעוד השינויים

## בעיה שנפתרה
הבוט היה מייצר הודעות ארוכות מדי (מעל 4096 תווים) כאשר היו הרבה דיווחי משתמשים, מה שגרם לכשל בשליחת ההודעה בטלגרם.

## הפיתרון שיושם

### 1. פונקציות חדשות ב-`src/utils.js`:

- **`splitLongMessage(message)`** - מפצלת הודעה ארוכה לכמה הודעות קטנות יותר
- **`formatResponseWithSplit()`** - גרסה חדשה של עיצוב התשובה עם פיצול אוטומטי
- **`splitUserReports()`** - מפצלת דיווחי משתמשים לחלקים נפרדים
- **`formatRedditReports()`** - עיצוב דיווחי Reddit בנפרד
- **`formatForumReports()`** - עיצוב דיווחי פורומים בנפרד  
- **`formatWebReports()`** - עיצוב דיווחי אתרים בנפרד
- **`checkMessageLength()`** - בדיקת אורך הודעה
- **`logMessageSplit()`** - לוגים לדיבאג

### 2. שינויים ב-`index.js`:

- שימוש ב-`formatResponseWithSplit()` במקום `formatResponse()`
- שליחת ההודעה הראשונה כעריכה של הודעת ההמתנה
- שליחת דיווחי המשתמשים כהודעות נפרדות עם המתנה של שנייה בין הודעות
- טיפול בשגיאות משופר
- לוגים מפורטים

### 3. הגבלות שהוספתי:

- **מגבלת טלגרם**: 4096 תווים להודעה
- **מגבלת דיווחים**: מקסימום 10 דיווחי Reddit, 10 דיווחי פורומים, 8 דיווחי אתרים
- **מגבלת הודעות**: מקסימום 4 הודעות נפרדות (כדי למנוע ספאם)
- **המתנה בין הודעות**: שנייה אחת (כדי למנוע rate limiting)

## איך זה עובד עכשיו:

1. **הודעה ראשית**: מכילה את הניתוח העיקרי, ההמלצה, היתרונות והסיכונים
2. **הודעת Reddit**: דיווחי משתמשים מ-Reddit (אם יש)
3. **הודעת פורומים**: דיווחי משתמשים מפורומים טכניים (אם יש)
4. **הודעת אתרים**: דיווחי משתמשים מאתרי טכנולוגיה (אם יש)

## יתרונות:

✅ **פתרון בעיית ההודעה הארוכה** - הודעות לא נכשלות יותר  
✅ **ארגון טוב יותר** - המידע מחולק לקטגוריות ברורות  
✅ **גמישות** - אם אין דיווחי משתמשים, נשלחת רק הודעה אחת  
✅ **מניעת ספאם** - הגבלה על מספר ההודעות והדיווחים  
✅ **טיפול בשגיאות** - אם הודעה אחת נכשלת, השאר ממשיכות  
✅ **לוגים מפורטים** - מעקב אחר הפיצול והשליחה  

## דוגמה לפלט:

```
הודעה 1: ניתוח עיקרי + "דיווחי משתמשים יישלחו ב-2 הודעות נפרדות..."
הודעה 2: "👥 דיווחי משתמשים - Reddit" + כל הדיווחים מ-Reddit
הודעה 3: "👥 דיווחי משתמשים - פורומים טכניים" + כל הדיווחים מפורומים
```

## הערות למפתח:

- הפונקציה הישנה `formatResponse()` עדיין קיימת לתאימות לאחור
- ניתן לשנות את המגבלות בקלות על ידי עריכת הקבועים
- הלוגים עוזרים לעקוב אחר ביצועי הפיצול
- המתנה של שנייה בין הודעות מונעת rate limiting של טלגרם